name: Build and Test Campus Management System

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  windows-build:
    name: Windows Build
    runs-on: windows-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Setup MSVC Environment
      uses: ilammy/msvc-dev-cmd@v1

    - name: Create Directories
      run: |
        New-Item -ItemType Directory -Path data,credentials,logs -Force

    - name: Build Campus Management System
      run: |
        echo "Building Campus Management System..."
        cl simple_main.c /Fe:simple_campus.exe
        if (Test-Path "simple_campus.exe") {
          Write-Host "✅ Build successful"
          Get-Item "simple_campus.exe"
        } else {
          Write-Host "❌ Build failed"
          exit 1
        }

    - name: Test Application
      run: |
        echo "Testing application..."
        .\simple_campus.exe

    - name: Upload Artifacts
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: campus-windows
        path: simple_campus.exe

  ubuntu-build:
    name: Ubuntu Build
    runs-on: ubuntu-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Install Dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y build-essential

    - name: Create Directories
      run: mkdir -p data credentials logs

    - name: Build Campus Management System
      run: |
        echo "Building Campus Management System..."
        gcc simple_main.c -o simple_campus
        if [ -f "simple_campus" ]; then
          echo "✅ Build successful"
          ls -la simple_campus
        else
          echo "❌ Build failed"
          exit 1
        fi

    - name: Test Application  
      run: |
        echo "Testing application..."
        ./simple_campus

    - name: Upload Artifacts
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: campus-ubuntu
        path: simple_campus